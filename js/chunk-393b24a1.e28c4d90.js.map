{"version":3,"sources":["webpack:///./src/components/Visualization.vue","webpack:///./src/components/Visualization.vue?443e","webpack:///./src/components/Visualization.vue?481d"],"names":["class","id","popper-class","startTime","type","placeholder","shortcuts","endTime","cName","clearable","query","setup","baseUrl","FORMAT","FORMAT_SHOW","startTimeRef","endTimeRef","cNameRef","data","xAxis","text","value","Date","date","setTime","getTime","chartByDay","divTotal","divCName","echarts","document","getElementById","dispose","xAxisTmp","JSON","parse","localStorage","getItem","dataTmp","cNameTmp","length","sum","reduce","item","innerHTML","setOption","title","tooltip","stringify","yAxis","series","name","dataZoom","xAxisIndex","console","log","method","url","format","headers","then","res","status","byDay","message","first","arr","filter","total","setItem","idx","diff","n","tmpDate","i","time","days","push","add","router","a","interceptors","request","use","config","token","Authorization","error","Promise","reject","__exports__","render"],"mappings":"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","file":"js/chunk-393b24a1.e28c4d90.js","sourcesContent":["<template>\n  <div class=\"visualization\">\n    <div class=\"select\">\n      <span class=\"text\">起始时间</span>\n      <el-date-picker\n          popper-class=\"startTime\"\n          v-model=\"startTime\"\n          type=\"datetime\"\n          placeholder=\"Select date and time\"\n          :shortcuts=\"shortcuts\"\n      />\n      <span class=\"text\">结束时间</span>\n      <el-date-picker\n          popper-class=\"endTime\"\n          v-model=\"endTime\"\n          type=\"datetime\"\n          placeholder=\"Select date and time\"\n          :shortcuts=\"shortcuts\"\n      />\n      <span class=\"text\">公司名</span>\n      <el-input v-model=\"cName\" placeholder=\"置空可查询总投递量\" clearable />\n      <el-button class=\"query\" type=\"success\" @click=\"query\">查询</el-button>\n      </div>\n      <div class=\"show\">\n      <div id=\"cName\"></div>\n      <div id=\"total\"></div>\n      <div id=\"byDay\"></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {onMounted, ref, watch} from \"vue\"\nimport * as echarts from 'echarts';\nimport axios from \"axios\"\nimport qs from \"qs\"\nimport {ElNotification} from \"element-plus\"\nimport router from \"@/router\"\nimport dayjs from \"dayjs\"\nimport {getApiRootPath} from \"@/utils/url\"\n\n\nexport default {\n  setup() {\n    const baseUrl = getApiRootPath()\n      const FORMAT = 'YYYY-MM-DD HH:mm:ss'\n      const FORMAT_SHOW = 'YYYY-MM-DD'\n      const startTimeRef = ref('')\n      const endTimeRef = ref('')\n      const cNameRef = ref('')\n    let data = ref([])\n    let xAxis = ref([])\n    let cName = ref('')\n\n      const shortcuts = [\n      {\n        text: 'Today',\n        value: () => new Date(),\n      },\n      {\n        text: 'Yesterday',\n        value: () => {\n        const date = new Date()\n        date.setTime(date.getTime() - 3600 * 1000 * 24)\n        return date\n      },\n      },\n      {\n        text: 'A week ago',\n        value: () => {\n        const date = new Date()\n        date.setTime(date.getTime() - 3600 * 1000 * 24 * 7)\n        return date\n      },\n      },\n        {\n          text: 'A month ago',\n          value: () => {\n            const date = new Date()\n            date.setTime(date.getTime() - 3600 * 1000 * 24 * 30)\n            return date\n          },\n        },\n      ]\n\n      const chartByDay = ref()\n    const divTotal = ref()\n    const divCName = ref()\n    onMounted(()=>{\n      echarts.init(document.getElementById('byDay')).dispose()\n      chartByDay.value = echarts.init(document.getElementById('byDay'));\n      divTotal.value = document.getElementById('total');\n      divCName.value = document.getElementById('cName');\n      const xAxisTmp = JSON.parse(localStorage.getItem('KnowFutureVisualization-xAxis'))\n      const dataTmp = JSON.parse(localStorage.getItem('KnowFutureVisualization-data'))\n      const cNameTmp = JSON.parse(localStorage.getItem('KnowFutureVisualization-cName'))\n      if (!(xAxisTmp && dataTmp)) {\n        console.log(\"here\")\n        return\n      }\n      xAxis.value = xAxisTmp\n      data.value = dataTmp\n      cName.value = cNameTmp\n      startTimeRef.value = xAxis.value[0]\n      endTimeRef.value = xAxis.value[xAxis.value.length-1]\n      cNameRef.value = cName.value\n      const sum = data.value.reduce((sum,item) => sum+item,0)\n      divTotal.value.innerHTML = cName.value ? `所选时间范围该公司投递量为：${sum} <br/>` : `所选时间范围总投递量为：${sum} <br/>`\n      divCName.value.innerHTML = cName.value ? \"公司名：\"+ cName.value : \"总投递量\";\n      chartByDay.value.setOption({\n        title: {\n          text: '每日投递量'\n        },\n        tooltip: {},\n        xAxis: {\n          data:JSON.parse(JSON.stringify(xAxis.value))\n          // data:xAxis.value\n        },\n        yAxis: {},\n        series: [\n          {\n            // name: cName.value,\n            name: JSON.parse(JSON.stringify(cName.value)),\n            type: 'bar',\n            // data: data.value\n            data: JSON.parse(JSON.stringify(data.value))\n          }\n        ],\n        dataZoom: [\n          {\n            id: 'dataZoomX',\n            type: 'inside',\n            xAxisIndex: [0],\n          }\n        ]\n      });\n    })\n    watch([data, xAxis, cName],()=>{\n      console.log(\"hi\")\n      console.log(data.value, xAxis.value, cName.value)\n      console.log(JSON.parse(JSON.stringify(xAxis.value)))\n      console.log(JSON.parse(JSON.stringify(cName.value)))\n      console.log(JSON.parse(JSON.stringify(data.value)))\n      chartByDay.value.setOption({\n        title: {\n          text: '每日投递量'\n        },\n        tooltip: {},\n        xAxis: {\n          data:JSON.parse(JSON.stringify(xAxis.value))\n          // data:xAxis.value\n        },\n        yAxis: {},\n        series: [\n          {\n            // name: cName.value,\n            name: JSON.parse(JSON.stringify(cName.value)),\n            type: 'bar',\n            // data: data.value\n            data: JSON.parse(JSON.stringify(data.value))\n          }\n        ],\n        dataZoom: [\n          {\n            id: 'dataZoomX',\n            type: 'inside',\n            xAxisIndex: [0],\n          }\n        ]\n      });\n    })\n    const query = () => {\n// 基于准备好的dom，初始化echarts实例\n      axios({\n        method: \"post\",\n        url: `${baseUrl}/api/visualization/company-total-by-day`,\n        data: qs.stringify({\n              // startTime: \"2022-12-27 00:00:00\",\n              // endTime: \"2023-12-28 00:00:00\",\n          startTime:dayjs(startTimeRef.value).format(FORMAT),\n          endTime:dayjs(endTimeRef.value).format(FORMAT),\n              cName: cNameRef.value\n            }\n        ),\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\"\n        }\n      }).then((res) => {\n        const status = res.data.status\n        const {data:byDay} = res.data\n        if (status === \"0\") {\n          if (byDay.length === 0 && cNameRef.value) {\n            ElNotification({\n              title: \"暂无投递数据，请确认公司名称及起止时间是否正确\",\n              message: \"query get null\",\n              type: \"warning\",\n            });\n          } else {\n            const first = byDay[0]\n            const arr = byDay.filter(item=>item.cName === first.cName)\n            if (byDay.length !== arr.length) {\n              ElNotification({\n                title: \"无法确定要查询的公司，请细化公司名称\",\n                message: \"query get null\",\n                type: \"warning\",\n              });\n            } else {\n            ElNotification({\n              title: \"查询成功\",\n              message: \"query successfully\",\n              type: \"success\",\n            });\n            const sum = byDay.reduce((sum,item) => sum+item.total,0)\n            cName.value = first.cName || \"\"\n            divTotal.value.innerHTML = cName.value ? `所选时间范围该公司投递量为：${sum} <br/>` : `所选时间范围总投递量为：${sum} <br/>`\n            divCName.value.innerHTML = cName.value ? \"公司名：\"+ cName.value : \"总投递量\";\n            localStorage.setItem('KnowFutureVisualization-cName', JSON.stringify(cName.value))\n              data.value = []\n            xAxis.value = []\n            let idx = 0\n            const diff = new Date(dayjs(endTimeRef.value).format(FORMAT_SHOW)).getTime() - new Date(dayjs(startTimeRef.value).format(FORMAT_SHOW)).getTime()\n            const n = diff / (24 * 60 * 60 * 1000);\n            console.log(res.data)\n            let tmpDate = dayjs(startTimeRef.value);\n            console.log(n)\n            for (let i = 0; i <= n; i++) {\n              const time = tmpDate.format(FORMAT_SHOW)\n              if(byDay[idx] && time === dayjs(byDay[idx].days).format(FORMAT_SHOW)){\n                data.value.push(byDay[idx].total)\n                idx++;\n              } else {\n                data.value.push(0)\n              }\n              xAxis.value.push(tmpDate.format(FORMAT_SHOW))\n              tmpDate = tmpDate.add(1,'day')\n            }\n            console.log(data)\n            console.log(xAxis)\n            localStorage.setItem('KnowFutureVisualization-xAxis', JSON.stringify(xAxis.value))\n            localStorage.setItem('KnowFutureVisualization-data', JSON.stringify(data.value))\n\n          }\n          }\n        } else if ( status === '401') {\n          ElNotification({\n            title: \"验证过期\",\n            message: res.data.message,\n            type: \"error\",\n          });\n          router.push(\"/home/login\");\n        }\n\n      });\n      axios.interceptors.request.use(\n          function (config) {\n            // 在发送请求之前做些什么\n            let token = localStorage.getItem('token');\n            if (token) {\n              config.headers.Authorization = token;\n            }\n            return config;\n          },\n          function (error) {\n            // 对请求错误做些什么\n            return Promise.reject(error);\n          }\n      );\n    }\n    return {\n        startTime: startTimeRef,\n      endTime: endTimeRef,\n      cName: cNameRef,\n      shortcuts,\n      query,\n    }\n  }\n}\n</script>\n\n<style>\n.visualization{\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-around;\n  width: 100vw;\n\n}\n.select{\n  height: 250px;\n  display: flex;\n  flex-direction: column;\n  justify-content: start;\n  align-items: start;\n  margin: 5px;\n}\n.query{\n  width: 220px;\n}\n\n@media (max-width: 500px) {\n  .el-picker-panel {        width: 87vw !important;    }\n  .el-picker-panel__content  {        width: 45vw !important;    }\n  .el-picker-panel__icon-btn {\n    width:20px;\n  }\n}\n\n\n.show{\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items:center;\n  height: 60vh;\n  width:  100vw;\n}\n#byDay{\n  height: 55vh;\n  width:  100vw;\n}\n\n</style>\n","import { render } from \"./Visualization.vue?vue&type=template&id=c24847ca\"\nimport script from \"./Visualization.vue?vue&type=script&lang=js\"\nexport * from \"./Visualization.vue?vue&type=script&lang=js\"\n\nimport \"./Visualization.vue?vue&type=style&index=0&id=c24847ca&lang=css\"\n\nimport exportComponent from \"/Users/yangyixuan/knowFutureManager/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Visualization.vue?vue&type=style&index=0&id=c24847ca&lang=css\""],"sourceRoot":""}